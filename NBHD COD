# Assuming 'data' is your data frame


# Create an empty data frame to store the results
NEIGH_cod <- data.frame(NEIGH = character(0), count = integer(0), cod = character(0), median = character(0), mean = character(0))


# Define the NEIGH categories of interest
NEIGH_categories_of_interest <- unique(data$NEIGH)


# Iterate through each NEIGH category and calculate the result
for (NEIGH_category in NEIGH_categories_of_interest) {
  # Filter the data to include only rows where NEIGH matches the current NEIGH category
  NEIGH_data <- data[data$NEIGH == NEIGH_category, ]

  #Add Heated SF to NEIGH_data
  NEIGH_data <- colnames(data)[colnames(data) == "HEATEDSF"] <- "HEATEDSF"

  # Calculate the number of sales in the current NEIGH category
  num_sales <- nrow(NEIGH_data)
  
  # Initialize the variables
  cod <- ""
  median_val <- ""
  mean_val <- ""
  
  if (num_sales > 0) {
    # Calculate the median and mean of ASR for the current NEIGH category
    median_value <- median(NEIGH_data$SRATIO, na.rm = TRUE)
    mean_value <- mean(NEIGH_data$SRATIO, na.rm = TRUE)

    # Calculate the ratio (subtract each element from the median and take the absolute value)
    ratios <- abs(NEIGH_data$SRATIO - median_value)
    
    # Calculate the average of the ratios
    average_ratio <- mean(ratios, na.rm = TRUE)
    
    # Divide the average_ratio by the median and multiply by 100
    cod <- round((average_ratio / median_value) * 100, 3)
    median_val <- round(median_value, 3)
  
    # Calculate the mean value without trimming
    mean_val <- round(mean_value, 3)
  }
  
  # Create a data frame with the NEIGH name, count, cod, median, and mean, and append it to NEIGH_cod
  result_df <- data.frame(NEIGH = NEIGH_category, count = num_sales, cod = cod, median = median_val, mean = mean_val)
  NEIGH_cod <- rbind(NEIGH_cod, result_df)
}

# Print the NEIGH_cod data frame
print(NEIGH_cod)
